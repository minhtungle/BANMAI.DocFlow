@using Public.Models
@model Applications.QuanLyNguoiDung.Dtos.GetList_NguoiDung_Output_Dto

@{
    string tableName = "useraccount";
    var columns = new[] {
        "Hoạt động", "Tên đăng nhập", "Tên người dùng",
        "Kiểu người dùng", "Cơ cấu tổ chức", "Kích hoạt", "Ngày tạo"
    };
}

<div class="card-body">
    <div class="mb-2 toggle-vis-bar">
        Hiển thị:
        @Public.Helpers.HtmlHelper.RenderToggleLinks($"{tableName}-getList", columns)
    </div>
    <table class="table table-hover table-bordered table-sticky w-100 nowrap" id="@tableName-getList" data-page-length="10">
        <thead>
            <tr>
                <th class="text-center" data-orderable="false"></th>

                @foreach (var c in columns)
                {
                    <th class="text-center">@c</th>
                }

                <th class="text-center" data-orderable="false">
                    <div style="white-space: nowrap">
                        <div class="btn-group btn-group-sm dropstart">
                            <button type="button" title="Thao tác" class="btn btn-primary dropdown-toggle dropdown-toggle-split"
                                    data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"
                                    data-reference="parent">
                                <i class="bi bi-gear-fill"></i>
                            </button>
                            <div class="dropdown-menu me-2" style="border: 1px solid black;">
                                @{
                                    bool themMoi = Model.ThaoTacs.Exists(x => x.MaThaoTac == "quanlynguoidung-themmoi");
                                    bool capNhat_Multiple = Model.ThaoTacs.Exists(x => x.MaThaoTac == "quanlynguoidung-capnhat");
                                    bool xoaBo_Multiple = Model.ThaoTacs.Exists(x => x.MaThaoTac == "quanlynguoidung-xoabo");
                                    if (themMoi)
                                    {
                                        <a class="dropdown-item c-pointer"
                                           onclick="ua.nguoiDung.displayModal_CRUD('create')">
                                            <i class="bi bi-plus-circle-fill"></i> Thêm mới
                                        </a>
                                    }
                                    if (capNhat_Multiple)
                                    {
                                        <a class="dropdown-item c-pointer"
                                           onclick="ua.nguoiDung.displayModal_CRUD('update')">
                                            <i class="bi bi-pencil-square"></i> Cập nhật
                                        </a>
                                    }
                                    if (xoaBo_Multiple)
                                    {
                                        <a class="dropdown-item c-pointer"
                                           onclick="ua.nguoiDung.displayModal_Delete('multiple')">
                                            <i class="bi bi-trash3-fill"></i> Xóa bỏ
                                        </a>
                                    }
                                }
                            </div>
                        </div>
                    </div>
                </th>
            </tr>
        </thead>
        <tfoot class="show-footer-above">
            <tr>
                <th class="text-center"><input class="form-check-input checkAll-@tableName-getList" type="checkbox" title="Chọn tất cả" /></th>

                @foreach (var c in columns)
                {
                    <th><input type="text" class="form-control dt-search-col" placeholder="Tìm kiếm ..." /></th>
                }

                <th><input type="text" class="form-control dt-search-col" placeholder="Tìm kiếm ..." disabled /></th>
            </tr>
        </tfoot>
        <tbody>
            @foreach (var nguoiDung in Model.NguoiDungs)
            {
                <tr id="@nguoiDung.NguoiDung.IdNguoiDung">
                    <td class="text-center"><input class="form-check-input checkRow-@tableName-getList" type="checkbox" /></td>

                    <td class="text-center">
                        @if (nguoiDung.NguoiDung.Online.HasValue && nguoiDung.NguoiDung.Online.Value == true)
                        {
                            <span hidden>online, trực tuyến</span>
                            <span class="badge bg-success"><i class="bi bi-wifi"></i></span>
                        }
                        else
                        {
                            <span hidden>offline, ngoại tuyến</span>
                            <span class="badge bg-danger"><i class="bi bi-wifi-off"></i></span>
                        }
                    </td>
                    <td class="text-center">
                        <span>@nguoiDung.NguoiDung.TenDangNhap</span>
                        @if (Model.Permission.NguoiDung.IdNguoiDung == nguoiDung.NguoiDung.IdNguoiDung)
                        {
                            <br />
                            <span class="text-danger fst-italic"> (Đang sử dụng)</span>
                        }
                    </td>
                    <td class="text-center">@nguoiDung.NguoiDung.TenNguoiDung</td>
                    <td class="text-center">@nguoiDung.KieuNguoiDung.TenKieuNguoiDung</td>
                    <td class="text-center">@nguoiDung.CoCauToChuc.TenCoCauToChuc</td>
                    <td class="text-center">
                        @if (nguoiDung.NguoiDung.KichHoat.HasValue && nguoiDung.NguoiDung.KichHoat.Value == true)
                        {
                            <span class="badge bg-success">Kích hoạt</span>
                        }
                        else
                        {
                            <span class="badge bg-danger">Vô hiệu hóa</span>
                        }
                    </td>

                    <td class="text-center">
                        <div style="white-space: nowrap">
                            <div class="btn-group btn-group-sm dropstart">
                                <button type="button" title="Thao tác" class="btn btn-primary dropdown-toggle dropdown-toggle-split"
                                        data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"
                                        data-reference="parent">
                                    <i class="bi bi-gear-fill"></i>
                                </button>
                                <div class="dropdown-menu me-2" style="border: 1px solid black;">
                                    @{
                                        bool capNhat = Model.ThaoTacs.Exists(x => x.MaThaoTac == "quanlynguoidung-capnhat");
                                        bool xoaBo = Model.ThaoTacs.Exists(x => x.MaThaoTac == "quanlynguoidung-xoabo");
                                        if (capNhat)
                                        {
                                            <a class="dropdown-item c-pointer"
                                               onclick="ua.nguoiDung.displayModal_CRUD('update', '@nguoiDung.NguoiDung.IdNguoiDung')">
                                                <i class="bi bi-pencil-square"></i> Cập nhật
                                            </a>
                                        }
                                        if (xoaBo)
                                        {
                                            <a class="dropdown-item c-pointer"
                                               onclick="ua.nguoiDung.displayModal_Delete('single', '@nguoiDung.NguoiDung.IdNguoiDung')">
                                                <i class="bi bi-trash3-fill"></i> Xóa bỏ
                                            </a>
                                        }
                                    }
                                </div>
                            </div>
                        </div>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>
