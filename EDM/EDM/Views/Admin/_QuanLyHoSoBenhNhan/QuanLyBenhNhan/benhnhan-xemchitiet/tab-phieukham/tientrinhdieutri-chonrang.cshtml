@using EDM_DB
@using Public.Enums
@using Public.Helpers
@model Applications.QuanLyLichDieuTri.Dtos.DisplayModal_ChonRang_Output_Dto
@{
    string chuoiRang = (Model.SoRangDaChons != null && Model.SoRangDaChons.Any())
        ? string.Join(", ", Model.SoRangDaChons)
        : string.Empty;

    string renderHTMLRang(List<default_tbRang> input)
    {
        string html = "";
        foreach (var rang in input)
        {
            var _checked = Model.SoRangDaChons.Contains((int)rang.ViTri);

            html += $"<td class=\"text-center c-pointer\" title=\"{rang.MoTa}\">\n     " +
            $"<div class=\"form-check\">\n         " +
            $"<input class=\"form-check-input checkbox-rang\" type=\"checkbox\" id=\"checkbox-{rang.IdRang}\"\n                " +
            $"data-idrang=\"{rang.IdRang}\" data-vitri=\"{rang.ViTri}\" {(_checked ? "checked" : "")}>\n         " +
            $"<label class=\"form-check-label\" for=\"checkbox-{rang.IdRang}\">\n             " +
            $"{rang.TenRang}\n         " +
            $"</label>\n     " +
            $"</div>\n " +
            $"</td>";
        }
        return html;
    }

    @*@foreach (var rang in Model.SoDoHamRang_NguoiLon.HamTren_BenTrai)
        {
            <td class="text-center c-pointer" title="@rang.MoTa">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="checkbox-@rang.IdRang"
                           data-idrang="@rang.IdRang">
                    <label class="form-check-label" for="checkbox-@rang.IdRang">
                        @rang.TenRang
                    </label>
                </div>
            </td>
        }*@
}

<div class="modal-dialog modal-dialog-scrollable modal-full" role="document">
    <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title col-md-6 col-sm-12 my-2">
                Chọn răng
            </h5>
            <div class="list-group list-group-horizontal mb-1 text-center col-md-6 col-sm-12 justify-content-sm-end justify-content-center" id="" role="tablist">
                <a class="list-group-item list-group-item-action active" id="thongtin-list"
                   data-bs-toggle="list" href="#thongtin" role="tab">Thông tin chung</a>
            </div>
        </div>
        <div class="modal-body">
            <div class="tab-content text-justify">
                <div class="tab-pane fade show active" id="thongtin" role="tabpanel"
                     aria-labelledby="thongtin-list">
                    <div class="row" intro-container="thongtin-chung">
                        <!--Id-->
                        <input id="input-idtientrinhdieutri" value="@Model.IdTienTrinhDieuTri" hidden />

                        <!--Răng đã chọn-->
                        <!--<div class="col-12">
                            <div class="position-relative">
                                <div class="form-group mb-3">
                                    <label class="required" for="input-rangdachon">Răng đã chọn</label>
                                    <input type="text"
                                           class="form-control" id="input-rangdachon"
                                           placeholder="Chọn răng theo sơ đồ"
                                           value="@(chuoiRang)" required>
                                    <div class="invalid-feedback feedback" for="input-rangdachon">Không được để trống</div>
                                </div>
                            </div>
                        </div>-->
                        <!--Sơ đồ hàm răng-->
                        <div class="col-12">
                            <div class="position-relative">
                                <div class="form-group mb-3">
                                    <label class="required">Sơ đồ hàm răng</label>
                                    <div class="row">
                                        <div class="col-12 table-responsive">
                                            <table class="table table-hover table-bordered" id="table-sodohamrang">
                                                <thead>
                                                    <tr>
                                                        <th colspan="16" class="text-center font-bold text-danger">Răng người lớn</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <!--Hàm trên người lớn-->
                                                    <tr style="white-space: nowrap;">
                                                        @Html.Raw(renderHTMLRang(Model.SoDoHamRang_NguoiLon.HamTren_BenPhai))
                                                        @Html.Raw(renderHTMLRang(Model.SoDoHamRang_NguoiLon.HamTren_BenTrai))
                                                    </tr>
                                                    <!--Hàm dưới người lớn-->
                                                    <tr>
                                                        @Html.Raw(renderHTMLRang(Model.SoDoHamRang_NguoiLon.HamDuoi_BenPhai))
                                                        @Html.Raw(renderHTMLRang(Model.SoDoHamRang_NguoiLon.HamDuoi_BenTrai))
                                                    </tr>
                                                </tbody>
                                                <thead>
                                                    <tr>
                                                        <th colspan="16" class="text-center font-bold text-danger">Răng trẻ em</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <!--Hàm trên trẻ em-->
                                                    <tr style="white-space: nowrap;">
                                                        <td colspan="3" class="text-center align-middle"></td>
                                                        @Html.Raw(renderHTMLRang(Model.SoDoHamRang_TreEm.HamTren_BenPhai))
                                                        @Html.Raw(renderHTMLRang(Model.SoDoHamRang_TreEm.HamTren_BenTrai))
                                                        <td colspan="3" class="text-center align-middle"></td>
                                                    </tr>
                                                    <!--Hàm dưới trẻ em-->
                                                    <tr>
                                                        <td colspan="3" class="text-center align-middle"></td>
                                                        @Html.Raw(renderHTMLRang(Model.SoDoHamRang_TreEm.HamDuoi_BenPhai))
                                                        @Html.Raw(renderHTMLRang(Model.SoDoHamRang_TreEm.HamDuoi_BenTrai))
                                                        <td colspan="3" class="text-center align-middle"></td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-primary ml-1" onclick="quanLyBenhNhan.benhNhan.lichDieuTri.tienTrinhDieuTri.chonRang()">
                <span class="">Lưu</span>
            </button>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                <span class="">Đóng</span>
            </button>
        </div>
    </div>
</div>